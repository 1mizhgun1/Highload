# Notion

## Содержание
[1. Тема и целевая аудитория](#1-тема-и-целевая-аудитория)

[2. Расчет нагрузки](#2-расчет-нагрузки)

## 1. Тема и целевая аудитория
Notion — сервис для создания заметок и текстовых документов, списков дел, баз данных, таблиц, канбан-досок, баз знаний, ведения проектов и совместной работы.

### Функционал MVP:
- создание и редактирование контента
- совместное редактирование
- управление доступом к контенту
- поддержка разного типа контента (таблицы, списки и прочее)
- прикрепление вложений
- поддержка вложенности контента
- домашняя страница со списком недавних страниц
- поиск своих страниц

### Целевая аудитория
По данным сайта [hypestat](https://hypestat.com/info/notion.so) Notion имеет такие метрики:
- более 5 млн уникальных пользователей в день (DAU)
- более 25 млн уникальных пользователей в месяц (MAU), которые создают более 150 млн заходов на сервис в месяц
- среднее время сессии пользователя - 9 минут
- в среднем пользователь за сессию посещает 9.5 страниц
- bounce rate сервиса - около 27%

### Распределение аудитории

#### По странам:

![img.png](images/img.png)

#### По полу и возрасту:

![img.png](images/img2.png)

## 2. Расчет нагрузки
По данным сайта [hypestat](https://hypestat.com/info/notion.so) значение DAU равно 5 млн, MAU - 25 млн.

### Объем сохраняемых данных

Всего в Notion зарегистрировано около 40 млн пользователей, исходя из чего можно оценить количество сохраняемых данных:

| хранимые данные           | средний размер единицы | ед/пользователь | сколько единиц | суммарный объем |
|---------------------------|------------------------|:---------------:|----------------|-----------------|
| профиль пользователя      | 5 Кб                   |        1        | 40 млн         | 200 Гб          | 
| страницы (без вложений)   | 50 Кб                  |       2.5       | 100 млн        | 5 Тб            |
| вложения                  | 150 кб                 |      1.75       | 70 млн         | 10.5 Тб         |

Суммарный размер хранилищ: 15.7 Тб, из которых 10.5 Тб - хранилище вложений.

### Запросы пользователей в день и RPS

Предположительные данные по среднему количеству запросов пользователя представлены в таблице ниже. RPS можно вычислить по формуле: RPS = среднее_кол-во_действий_в_день * DAU / 86400

| Действие                          | Среднее количество в день на пользователя | RPS |
|-----------------------------------|:-----------------------------------------:|-----|
| посещение домашней страницы       |                     5                     | 290 |
| создание страницы                 |                    0.4                    | 23  |
| поиск страниц                     |                     3                     | 174 |
| регистрация/авторизация           |                    0.5                    | 29  |
| редактирование страницы           |                     3                     | 174 |
| заход на страницу                 |                     6                     | 347 |
| прикрепление вложений             |                     2                     | 116 |
| изменение прав доступа к странице |                    0.7                    | 41  |

Получаем, что в среднем пользователь делает 20.6 запросов в день.

Средний RPS в течение дня: 1194. Заложим на пиковый RPS х2.5 от среднего, получим **пиковую нагрузку в ~3000 RPS**.

### Сетевой трафик

С помощью инструментов разработчика в браузере можно посмотреть средник трафик на каждое действие пользователя.

Нагрузку на сеть можно расчитать по формуле: нагрузка[Гбит/c] = средний_трафик_на_действие * RPS * 8 / 1024 / 1024

| Действие                          | Средний трафик на одно действие | Нагрузка на сеть |
|-----------------------------------|---------------------------------|------------------|
| посещение домашней страницы       | 550 Кб                          | 1.22 Гбит/с      |
| создание страницы                 | 210 Кб                          | 0.04 Гбит/c      |
| поиск страниц                     | 370 Кб                          | 0.49 Гбит/с      |
| регистрация/авторизация           | 150 Кб                          | 0.03 Гбит/с      |
| редактирование страницы           | 700 Кб                          | 0.93 Гбит/с      |
| заход на страницу                 | 490 Кб                          | 1.30 Гбит/с      |
| прикрепление вложений             | 1230 Кб                         | 1.09 Гбит/с      |
| изменение прав доступа к странице | 350 Кб                          | 0.11 Гбит/с      |

Средний трафик на одного пользователя в день: <br/> 5x550+0.4x210+3x370+0.5x150+3x700+6x490+2x1230+0.7x350 = 0.09 Гбит/день

Суммарная нагрузка на сеть: 5.21 Гбит/с <br/> Пусть пиковая нагрузка будет в 2.5 раз больше, чем средняя. **Получаем пиковую нагрузку: ~13 Гбит/с**

